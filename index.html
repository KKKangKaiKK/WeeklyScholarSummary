<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯å‘¨æ±‡æ€» - é¦–é¡µ</title>
    <style>
        /* å¤åˆ»æä¾›çš„é£æ ¼ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Helvetica Neue", "Arial", "PingFang SC", "Microsoft YaHei", sans-serif;
            line-height: 1.7;
            color: #4a4a4a;
            background-color: #f4f7f9;
            margin: 0;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.07);
            min-height: 300px; /* é˜²æ­¢å†…å®¹åŠ è½½æ—¶é«˜åº¦è·³åŠ¨ */
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 20px;
            margin-bottom: 35px;
        }

        h1 {
            margin: 0;
            color: #2c3e50;
            font-size: 28px;
            font-weight: 700;
        }

        .subtitle {
            color: #888;
            font-size: 15px;
            margin-top: 8px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-primary {
            display: inline-block;
            background-color: #3498db;
            color: #ffffff;
            text-decoration: none;
            padding: 12px 30px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 16px;
            transition: background-color 0.3s, transform 0.2s;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.2);
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-1px);
            color: #ffffff !important; /* è¦†ç›–å…¨å±€ a:hover */
        }

        /* åˆ—è¡¨éƒ¨åˆ†æ ·å¼ */
        h2 {
            color: #2980b9;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 24px;
            font-weight: 600;
        }

        .summary-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .summary-item {
            background-color: #f8f9fa;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-item:hover {
            background-color: #f1f4f6;
        }

        .summary-link {
            text-decoration: none;
            color: #34495e;
            font-weight: 600;
            font-size: 18px;
            display: block;
            width: 100%;
        }

        .summary-link:hover {
            color: #e74c3c !important;
        }

        /* çŠ¶æ€æç¤ºæ ·å¼ */
        .status-box {
            text-align: center;
            padding: 40px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px auto;
        }

        .error-msg {
            color: #e74c3c;
            background: #fdeaea;
            padding: 15px;
            border-radius: 6px;
            display: inline-block;
            text-align: left;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* éšè—ç±» */
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <h1>æ¯å‘¨ RSS åŠ¨æ€æ€»ç»“</h1>
            <p class="subtitle" id="current-status">æ­£åœ¨è·å–æœ€æ–°æ•°æ®...</p>
        </div>

        <!-- åŠ è½½ä¸­çŠ¶æ€ -->
        <div id="loading-view" class="status-box">
            <div class="loading-spinner"></div>
            <p style="color: #666;">æ­£åœ¨è¿æ¥ GitHub ä»“åº“è·å–å‘¨æŠ¥...</p>
        </div>

        <!-- é”™è¯¯çŠ¶æ€ -->
        <div id="error-view" class="status-box hidden">
            <div class="error-msg">
                <h3 style="margin-top:0; color:#c0392b;">âš ï¸ åŠ è½½å¤±è´¥</h3>
                <p id="error-text" style="margin-bottom: 10px; font-size: 14px;"></p>
                <button onclick="location.reload()" style="cursor:pointer; padding: 5px 15px; border:1px solid #c0392b; background:white; color:#c0392b; border-radius:4px;">é‡è¯•</button>
            </div>
        </div>

        <!-- å†…å®¹å±•ç¤ºåŒº (æˆåŠŸåŠ è½½åæ˜¾ç¤º) -->
        <div id="content-view" class="hidden">
            <!-- æ ¸å¿ƒæ“ä½œåŒºï¼šæœ€æ–°ä¸€æœŸ -->
            <div style="text-align: center; margin-bottom: 40px;">
                <p style="margin-bottom: 15px; color: #555;">é˜…è¯»æœ€æ–°å‘å¸ƒçš„æ±‡æ€»ï¼š</p>
                <a id="btn-latest" href="#" class="btn-primary">
                    ğŸš€ è·³è½¬åˆ°æœ€æ–°å‘¨æŠ¥
                </a>
                <p id="latest-date-hint" style="font-size: 13px; color: #888; margin-top: 10px;"></p>
            </div>

            <!-- è¿‘æœŸ Top 3 åˆ—è¡¨ -->
            <div>
                <h2>è¿‘æœŸå‘å¸ƒ (Top 3)</h2>
                <div id="list-container" style="margin-top: 20px;">
                    <!-- JavaScript å°†åœ¨è¿™é‡Œæ’å…¥æ•°æ® -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 40px; border-top: 1px solid #eee; padding-top: 20px;">
                <a href="https://github.com/KKKangKaiKK/WeeklyScholarSummary/tree/main/summaries" target="_blank" style="color: #3498db; text-decoration: none; font-size: 14px;">ğŸ”— æŸ¥çœ‹ GitHub ä»“åº“æ‰€æœ‰å†å²å½’æ¡£</a>
            </div>
        </div>
    </div>

    <script>
        // é…ç½®ä¿¡æ¯
        const config = {
            owner: 'KKKangKaiKK',
            repo: 'WeeklyScholarSummary',
            path: '', // å¦‚æœsummariesåœ¨æ ¹ç›®å½•åˆ™ç•™ç©º
            timeout: 8000 // è¶…æ—¶æ—¶é—´ï¼š8ç§’
        };

        const apiUrl = `https://api.github.com/repos/${config.owner}/${config.repo}/contents/summaries`;
        const baseUrl = `https://${config.owner.toLowerCase()}.github.io/${config.repo}/summaries/`;

        // DOM å…ƒç´ 
        const loadingView = document.getElementById('loading-view');
        const contentView = document.getElementById('content-view');
        const errorView = document.getElementById('error-view');
        const errorText = document.getElementById('error-text');
        const currentStatus = document.getElementById('current-status');
        const btnLatest = document.getElementById('btn-latest');
        const listContainer = document.getElementById('list-container');
        const latestDateHint = document.getElementById('latest-date-hint');

        // è¶…æ—¶ Promise
        const timeoutPromise = new Promise((_, reject) => {
            setTimeout(() => {
                reject(new Error("è¯·æ±‚è¶…æ—¶ï¼šGitHub API å“åº”æ—¶é—´è¿‡é•¿ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚"));
            }, config.timeout);
        });

        // è·å–æ•°æ® Promise
        const fetchPromise = fetch(apiUrl).then(response => {
            if (!response.ok) {
                throw new Error(`HTTP é”™è¯¯: ${response.status} ${response.statusText}`);
            }
            return response.json();
        });

        // æ‰§è¡Œé€»è¾‘
        Promise.race([fetchPromise, timeoutPromise])
            .then(data => {
                // 1. ç­›é€‰ç¬¦åˆ YYYY-MM-DD.html æ ¼å¼çš„æ–‡ä»¶
                const summaryFiles = data.filter(file => {
                    return /^\d{4}-\d{2}-\d{2}\.html$/.test(file.name);
                });

                if (summaryFiles.length === 0) {
                    throw new Error("ä»“åº“ä¸­æœªæ‰¾åˆ°ç¬¦åˆæ ¼å¼ (YYYY-MM-DD.html) çš„å‘¨æŠ¥æ–‡ä»¶ã€‚");
                }

                // 2. æ’åº (æ–‡ä»¶åé™åºï¼Œå³æ—¥æœŸä»æ–°åˆ°æ—§)
                summaryFiles.sort((a, b) => b.name.localeCompare(a.name));

                // 3. æå– Top 3
                const topFiles = summaryFiles.slice(0, 3);
                const latestFile = summaryFiles[0];

                // 4. æ¸²æŸ“ UI
                renderUI(latestFile, topFiles);
            })
            .catch(error => {
                showError(error);
            });

        function renderUI(latest, list) {
            // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºå†…å®¹
            loadingView.classList.add('hidden');
            contentView.classList.remove('hidden');
            
            // æ›´æ–°å‰¯æ ‡é¢˜æ—¥æœŸä¸ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            currentStatus.textContent = `è®¿é—®æ—¥æœŸ: ${today}`;

            // è®¾ç½®æœ€æ–°æŒ‰é’®é“¾æ¥
            const latestUrl = baseUrl + (config.path ? config.path + '/' : '') + latest.name;
            btnLatest.href = latestUrl;
            latestDateHint.textContent = `æœ€æ–°ä¸€æœŸï¼š${latest.name.replace('.html', '')}`;

            // ç”Ÿæˆåˆ—è¡¨
            let listHtml = '<ul class="summary-list">';
            list.forEach(file => {
                const fileUrl = baseUrl + (config.path ? config.path + '/' : '') + file.name;
                const dateText = file.name.replace('.html', '');
                
                listHtml += `
                    <li class="summary-item">
                        <a href="${fileUrl}" class="summary-link">
                            ğŸ“… ${dateText} æ±‡æ€»
                        </a>
                        <span style="font-size: 12px; color: #999;">HTML</span>
                    </li>
                `;
            });
            listHtml += '</ul>';
            listContainer.innerHTML = listHtml;
        }

        function showError(error) {
            console.error(error);
            loadingView.classList.add('hidden');
            contentView.classList.add('hidden');
            errorView.classList.remove('hidden');
            currentStatus.textContent = "çŠ¶æ€å¼‚å¸¸";
            currentStatus.style.color = "#e74c3c";
            
            // å‹å¥½çš„é”™è¯¯æç¤º
            let msg = error.message;
            if (msg.includes('Failed to fetch')) {
                msg = "ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜æˆ– GitHub API è®¿é—®å—é™ã€‚";
            }
            errorText.textContent = msg;
        }
    </script>
</body>
</html>